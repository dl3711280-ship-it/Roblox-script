local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Toggle = Instance.new("TextButton")
Toggle.Size = UDim2.new(0,100,0,40)
Toggle.Position = UDim2.new(0,10,0,10)
Toggle.BackgroundColor3 = Color3.fromRGB(0,255,0)
Toggle.Text = "BodyLock OFF"
Toggle.Parent = ScreenGui

local FovBox = Instance.new("TextBox")
FovBox.Size = UDim2.new(0,60,0,30)
FovBox.Position = UDim2.new(0,120,0,15)
FovBox.BackgroundColor3 = Color3.fromRGB(0,255,0)
FovBox.Text = "60"
FovBox.Parent = ScreenGui

local Circle = Drawing.new("Circle")
Circle.Visible = true
Circle.Color = Color3.fromRGB(0,255,0)
Circle.Thickness = 2
Circle.NumSides = 50
Circle.Filled = false
Circle.Radius = tonumber(FovBox.Text)
Circle.Position = Camera.ViewportSize/2

local Enabled = false

Toggle.MouseButton1Click:Connect(function()
    Enabled = not Enabled
    Toggle.Text = Enabled and "BodyLock ON" or "BodyLock OFF"
end)

FovBox.FocusLost:Connect(function()
    local v = tonumber(FovBox.Text)
    if v then
        Circle.Radius = v
    end
end)

local function getTarget()
    local closest,dist
    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local pos,onscreen = Camera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
            if onscreen then
                local mag = (Vector2.new(pos.X,pos.Y) - (Camera.ViewportSize/2)).Magnitude
                if mag < Circle.Radius and (not dist or mag < dist) then
                    dist = mag
                    closest = plr
                end
            end
        end
    end
    return closest
end

local function shoot(target)
    local gun = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Gun")
    if gun and gun:FindFirstChild("KnifeLocal") and gun.KnifeLocal:FindFirstChild("CreateBeam") then
        local rf = gun.KnifeLocal.CreateBeam:FindFirstChildOfClass("RemoteFunction")
        if rf and target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            rf:InvokeServer(target.Character.HumanoidRootPart.Position)
        end
    end
end

UserInputService.InputBegan:Connect(function(input,gp)
    if not gp and input.UserInputType == Enum.UserInputType.MouseButton1 then
        if Enabled then
            local t = getTarget()
            if t then
                shoot(t)
            end
        end
    end
end)

RunService.RenderStepped:Connect(function()
    Circle.Position = Camera.ViewportSize/2
end)
